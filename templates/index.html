<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>{{ (site.brand.name or 'HairDaze') ~ ' — ' ~ (site.brand.tagline or 'Where Style Meets Simplicity') }}</title>

  <!-- Theme vars from DB -->
  <style>
    :root{
      --brand-grad-start: {{ site.theme.gradient_start }};
      --brand-grad-end:   {{ site.theme.gradient_end }};
    }
  </style>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- Animated background canvas -->
  <canvas id="bgCanvas" class="bg-canvas" aria-hidden="true"></canvas>
  <!-- Soft cursor glow -->
  <div id="cursorGlow" aria-hidden="true"></div>

  {% set site_qs = site.slug and ('?site=' ~ site.slug) or '' %}

  <!-- Header -->
  <header>
    <div class="container header-inner">
      <a class="brand-link" href="{{ url_for('index') }}{{ site_qs }}">
        <h1 class="brand">{{ site.brand.name or 'HairDaze' }}</h1>
      </a>
      <button class="menu-btn" id="menuBtn" aria-label="Open menu">Menu</button>
      <nav id="mainNav" class="nav">
        <a href="{{ url_for('index') }}{{ site_qs }}">Home</a>
        <a href="#services">Services</a>
        <a href="#contact-section">Contact</a>
        <a class="btn btn-primary" href="{{ site.hero.cta_url or url_for('book') }}">{{ site.hero.cta_text or 'Book Now' }}</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="orbs" aria-hidden="true">
      <span class="orb orb-a"></span>
      <span class="orb orb-b"></span>
      <span class="orb orb-c"></span>
    </div>

    <div class="container hero-grid">
      <div class="hero-copy">
        <h2>{{ site.brand.tagline or "Where Style Meets Simplicity" }}</h2>
        <p>{{ site.hero.subtext or "Color, cuts, and styling done with care—and on your schedule." }}</p>
        <a href="{{ site.hero.cta_url or url_for('book') }}" id="bookCta" class="btn btn-primary">
          {{ site.hero.cta_text or 'Book Now' }}
        </a>
      </div>

      <!-- Art/photo panel (Ken Burns + crossfade + glaze) -->
      <div class="hero-media card">
        <div class="slides">
          {% if site.hero.images and site.hero.images|length > 0 %}
            {% for url in site.hero.images %}
              <img class="slide s{{ loop.index }}" src="{{ url }}" alt="Hero {{ loop.index }} — {{ site.brand.name }}">
            {% endfor %}
          {% else %}
            <!-- Fallback to local static images -->
            <img class="slide s1" src="{{ url_for('static', filename='hair1.png') }}" alt="Work sample 1">
            <img class="slide s2" src="{{ url_for('static', filename='hair2.png') }}" alt="Work sample 2">
            <img class="slide s3" src="{{ url_for('static', filename='hair3.png') }}" alt="Work sample 3">
          {% endif %}
        </div>
        <div class="glaze"></div>
        <div class="filmgrain" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section class="section services" id="services">
    <div class="container">
      <h2>Services</h2>

      <div class="grid grid-3">
        {% if site.services and site.services|length > 0 %}
          {% for s in site.services %}
          <div class="card service-card">
            <h3>{{ s.name }}</h3>
            {% if s.description %}<p>{{ s.description }}</p>{% endif %}
            {% if s.price %}<p class="muted">{{ s.price }}</p>{% endif %}
          </div>
          {% endfor %}
        {% else %}
          <!-- Fallback cards if no DB data yet -->
          <div class="card service-card">
            <h3>Signature Service</h3>
            <p>Thoughtfully crafted for your style and schedule.</p>
          </div>
          <div class="card service-card">
            <h3>Classic Service</h3>
            <p>Clean, consistent results from our trusted team.</p>
          </div>
          <div class="card service-card">
            <h3>Premium Add-On</h3>
            <p>Level up your look with an extra touch.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- About (simple; uses static fallback images) -->
  <section class="about">
    <div class="container about-grid">
      <div class="about-image card" data-parallax data-speed="0.15">
        <img src="{{ url_for('static', filename='hair1.png') }}" alt="{{ site.brand.name }} sample 1">
      </div>
      <div class="about-text">
        <h3>Your Look, Your Story</h3>
        <p>{{ site.brand.tagline or "We blend artistry and care to create a look that’s uniquely you." }}</p>
        <p><strong>Leave confident. Come back excited.</strong></p>
      </div>
      <div class="about-image card" data-parallax data-speed="-0.12">
        <img src="{{ url_for('static', filename='hair3.png') }}" alt="{{ site.brand.name }} sample 2">
      </div>
    </div>
  </section>

  <!-- Reviews (marquee) -->
  <section class="section reviews" aria-labelledby="reviews-title">
    <div class="container">
      <h2 id="reviews-title">What Our Clients Say</h2>

      <div class="reviews-marquee">
        <!-- track 1 -->
        <ul class="marquee-track" role="list">
          {% if site.reviews and site.reviews|length > 0 %}
            {% for r in site.reviews %}
            <li class="review-card card">
              <p class="review-text">“{{ r.text }}”</p>
              {% if r.author %}<p class="review-author">— {{ r.author }}</p>{% endif %}
              <p class="review-stars">{{ "★" * (r.stars or 5) }}</p>
            </li>
            {% endfor %}
          {% else %}
            <li class="review-card card">
              <p class="review-text">“Love the service. Friendly staff and great results!”</p>
              <p class="review-author">— Happy Client</p>
              <p class="review-stars">★★★★★</p>
            </li>
            <li class="review-card card">
              <p class="review-text">“Clean, quick, and exactly what I wanted.”</p>
              <p class="review-author">— Taylor</p>
              <p class="review-stars">★★★★★</p>
            </li>
            <li class="review-card card">
              <p class="review-text">“My go-to spot. Highly recommend.”</p>
              <p class="review-author">— Alex</p>
              <p class="review-stars">★★★★★</p>
            </li>
          {% endif %}
        </ul>

        <!-- duplicate track for a seamless loop -->
        <ul class="marquee-track" aria-hidden="true" role="list">
          {% if site.reviews and site.reviews|length > 0 %}
            {% for r in site.reviews %}
            <li class="review-card card">
              <p class="review-text">“{{ r.text }}”</p>
              {% if r.author %}<p class="review-author">— {{ r.author }}</p>{% endif %}
              <p class="review-stars">{{ "★" * (r.stars or 5) }}</p>
            </li>
            {% endfor %}
          {% else %}
            <li class="review-card card">
              <p class="review-text">“Warm and welcoming from start to finish.”</p>
              <p class="review-author">— Jordan</p>
              <p class="review-stars">★★★★★</p>
            </li>
            <li class="review-card card">
              <p class="review-text">“Fantastic quality every time.”</p>
              <p class="review-author">— Casey</p>
              <p class="review-stars">★★★★★</p>
            </li>
            <li class="review-card card">
              <p class="review-text">“Five stars all around.”</p>
              <p class="review-author">— Morgan</p>
              <p class="review-stars">★★★★★</p>
            </li>
          {% endif %}
        </ul>

        <div class="marquee-fade left" aria-hidden="true"></div>
        <div class="marquee-fade right" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section class="contact" id="contact-section">
    <div class="container">
      <h2><span class="orange">Get in Touch</span> <span class="teal">Contact Us</span></h2>
      <div class="contact-grid">
        <div class="contact-info card">
          <h3>Address</h3>
          <p>{{ site.contact.address or "414 E Walnut St, North Wales, PA 19454" }}</p>
          {% if site.contact.phone %}<p><strong>Phone:</strong> {{ site.contact.phone }}</p>{% endif %}
          {% if site.contact.email %}<p><strong>Email:</strong> {{ site.contact.email }}</p>{% endif %}

          {% if site.contact.map_embed %}
            <iframe src="{{ site.contact.map_embed }}" width="100%" height="200" style="border:0" loading="lazy" allowfullscreen></iframe>
          {% elif site.contact.address %}
            <iframe
              src="https://www.google.com/maps?q={{ site.contact.address | urlencode }}&output=embed"
              width="100%" height="200" style="border:0" loading="lazy" allowfullscreen></iframe>
          {% endif %}
        </div>

        <form id="contact-form" class="card">
          <input type="text" name="name" placeholder="Name" required />
          <input type="email" name="email" placeholder="Email" required />
          <input type="tel" id="phone" name="phone" placeholder="Phone number" maxlength="14" />
          <textarea name="message" placeholder="Say something :)" required></textarea>
          <button type="submit" class="btn btn-primary">Submit</button>
          <p id="contact-status" class="muted"></p>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <div class="container"><p>© {{ site.brand.name or 'HairDaze' }}. All rights reserved.</p></div>
  </footer>

  <!-- JS -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Mobile menu
    const menuBtn = document.getElementById('menuBtn');
    const mainNav = document.getElementById('mainNav');
    if (menuBtn && mainNav) menuBtn.addEventListener('click', () => mainNav.classList.toggle('open'));

    // Phone mask
    const phone = document.getElementById('phone');
    if (phone) phone.addEventListener('input', (e) => {
      let v = e.target.value.replace(/\D/g,'');
      if (v.length > 0) v = '(' + v;
      if (v.length > 4) v = v.slice(0,4) + ') ' + v.slice(4);
      if (v.length > 9) v = v.slice(0,9) + '-' + v.slice(9,13);
      e.target.value = v;
    });

    // Contact AJAX (optional; needs /api/contact on the server)
    const form = document.getElementById('contact-form');
    if (form){
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const status = document.getElementById('contact-status');
        status.textContent = 'Sending…';
        const payload = { name: form.name.value, email: form.email.value, phone: form.phone.value, message: form.message.value };
        try{
          const res = await fetch('/api/contact',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(payload)
          });
          const data = await res.json().catch(()=>({}));
          if (res.ok && data.ok){ status.textContent = 'Thanks! We’ll reply soon.'; form.reset(); }
          else { status.textContent = data.error || 'Something went wrong. Please try again.'; }
        }catch{ status.textContent = 'Network error. Please try again.'; }
      });
    }

    // Parallax
    const parallaxEls = document.querySelectorAll('[data-parallax]');
    const onScroll = () => {
      const t = window.scrollY;
      parallaxEls.forEach(el=>{
        const speed = parseFloat(el.dataset.speed || 0.1);
        el.style.transform = `translateY(${t*speed}px)`;
      });
    };
    onScroll(); window.addEventListener('scroll', onScroll, {passive:true});

    // Cursor glow
    const glow = document.getElementById('cursorGlow');
    if (glow){
      window.addEventListener('pointermove', (e)=>{
        glow.style.transform = `translate(${e.clientX - 75}px, ${e.clientY - 75}px)`;
      }, {passive:true});
    }

    // ===== Canvas background =====
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    function size(){
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.width = innerWidth*dpr; canvas.height = innerHeight*dpr;
      canvas.style.width = innerWidth + 'px'; canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    size(); addEventListener('resize', size);

    const COUNT = 190;
    const parts = new Array(COUNT).fill(0).map(()=>({
      x: Math.random()*innerWidth, y: Math.random()*innerHeight,
      v: .55 + Math.random()*1.25, w: .7 + Math.random()*1.2,
      life: 80 + Math.random()*150, hue: 18 + Math.random()*170
    }));

    let t = 0, last = performance.now();
    function field(x,y){ const s=.0011; return Math.sin((x+y)*s + t*.6) + Math.cos((x-y)*s*.9 - t*.35); }

    function draw(now){
      const dt = Math.min(40, now-last); last = now; t += dt/9000;

      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = 'rgba(255,255,255,0.06)';
      ctx.fillRect(0,0,innerWidth,innerHeight);

      ctx.globalCompositeOperation = 'lighter';
      parts.forEach(p=>{
        const a = field(p.x, p.y);
        const vx = Math.cos(a)*p.v, vy = Math.sin(a)*p.v;

        ctx.strokeStyle = `hsla(${p.hue}, 80%, 60%, 0.18)`;
        ctx.lineWidth = p.w;
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        p.x += vx * dt*0.06; p.y += vy * dt*0.06;
        ctx.lineTo(p.x, p.y); ctx.stroke();

        p.hue += 0.06; if (p.hue>210) p.hue = 18;
        if (--p.life<0 || p.x<-120 || p.x>innerWidth+120 || p.y<-120 || p.y>innerHeight+120){
          p.x=Math.random()*innerWidth; p.y=Math.random()*innerHeight; p.life=80+Math.random()*150;
        }
      });
      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);
  });
  </script>
</body>
</html>
